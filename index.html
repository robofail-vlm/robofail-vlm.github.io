<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>AHA: A Vision-Language-Model for Detecting and Reasoning Over Failures in Robotic Manipulation</title>
    <meta name="description" content="RoboFail">
    <meta name="keywords" content="Foundation Model, Affordance Prediction">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">
    <link rel="stylesheet" href="./static/css/bulma.min.css">
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
    <link rel="stylesheet" href="./static/css/index.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>
    <script src="./static/js/index.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <script>
        function init() {
            const video = document.getElementById("simulation-menu-video");
            video.addEventListener("error", () => {
                console.log("Error loading video: ", video.src), ". Setting default to none";
                if(video.src.includes("undefined")) {
                    console.log("Don't have an undefined version of the clip, just crash");
                    return;
                }
                const task = document.getElementById("simulation-menu-task-name").value;
                const uri = `static/videos/simulation/${task}/undefined.mp4`
                video.src = uri;
                video.playbackRate = 1.75;
                video.play();
            }, true);
        }

        function updateFailureModeVideo() {
            const task = document.getElementById("simulation-menu-task-name").value;
            const failure = document.getElementById("simulation-menu-failure-mode").value;
            const video = document.getElementById("simulation-menu-video");
            const uri = `static/videos/simulation/${task}/vid_${task}_${failure}.mp4`;
            video.src = uri;
            video.playbackRate = 1.75;
            video.play();
        }

        timeoutIds = [];

        function populateDemo(imgs, num, show_alt = true) {
            // Get the expanded image
            var expandImg = document.getElementById("expandedImg-" + num);
            // Get the image text
            var imgText = document.getElementById("imgtext-" + num);
            var answer = document.getElementById("answer-" + num);

            // Use the same src in the expanded image as the image being clicked on from the grid
            expandImg.src = imgs.src.replace(".png", ".mp4");
            var video = document.getElementById('demo-video-' + num);
            // or video = $('.video-selector')[0];
            video.pause()
            video.load();
            video.play();
            video.removeAttribute('controls');

            if (show_alt) {
                console.log(expandImg.src);

                imgText.style.display = "block";
                answer.style.display = "block";
                // Use the value of the alt attribute of the clickable image as text inside the expanded image
                var qa = imgs.alt.split("[sep]");
                imgText.innerHTML = qa[0];
                answer.innerHTML = "";
                // Show the container element (hidden with CSS)
                expandImg.parentElement.style.display = "block";
                for (timeoutId of timeoutIds) {
                    clearTimeout(timeoutId);
                }

                // NOTE (wliang): Modified from original to read from file instead
                fetch(qa[1])
                    .then(response => response.text())
                    .then(contents => {
                        // Call the processData function and pass the contents as an argument
                        typeWriter(contents, 0, qa[0], num);
                    })
                    .catch(error => console.error('Error reading file:', error));
            }
            else {
                imgText.style.display = "none";
                answer.style.display = "none";
            }
        }

        function typeWriter(txt, i, q, num) {
            var imgText = document.getElementById("imgtext-" + num);
            var answer = document.getElementById("answer-" + num);
            if (imgText.innerHTML == q) {
                for (let k = 0; k < 5; k++) {
                    if (i < txt.length) {
                        if (txt.charAt(i) == "\\") {
                            answer.innerHTML += "\n";
                            i += 1;
                        } else {
                            answer.innerHTML += txt.charAt(i);
                        }
                        i++;
                    }
                }
                hljs.highlightAll();
                timeoutIds.push(setTimeout(typeWriter, 1, txt, i, q, num));
            }
        }
    </script>

</head>

<body onload="init(); updateFailureModeVideo();">
    <!-- Title / Authors Info -->
    <section class="hero">
        <div class="hero-body">
            <div class="container is-max-desktop">
                <div class="columns is-centered">
                    <div class="column has-text-centered">
                        <h1 class="title is-1 publication-title">
                            RoboFail
                        </h1>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Failure videos per task -->
    <section class="section">
        <div class="container is-max-widescreen">
            <div class="rows">
                <div class="rows is-centered ">
                    <div class="row is-full-width">
                        <h2 class="title is-3">RoboFail Failure Modes</h2>
                        <div class="columns">
                            <div class="column has-text-centered">
                                <h3 class="title is-5">Failure modes</h3>
                                Task
                                <div class="select is-small">
                                    <select id="simulation-menu-task-name" onchange="updateFailureModeVideo()">
                                        <option value="basketball_in_hoop" selected="selected">basketball</option>
                                        <option value="close_box">close box</option>
                                        <option value="close_laptop_lid">close laptop</option>
                                        <option value="get_ice_from_fridge">get ice from fridge</option>
                                        <option value="hockey">hockey</option>
                                        <option value="insert_onto_square_peg">insert peg</option>
                                        <option value="meat_on_grill">meat on grill</option>
                                        <option value="open_drawer">open drawer</option>
                                        <!-- 
                                        <option value="put_money_in_safe"> put money in safe</option>
                                        <option value="reach_and_drag">reach and drag</option>
                                        <option value="scoop_with_spatula">scoop with spatula</option>
                                        <option value="setup_chess">setup chessboard</option>
                                        <option value="slide_block_to_target">slide block</option>
                                        <option value="stack_cups">stack cups</option>
                                        <option value="straighten_rope">straighten rope</option>
                                        <option value="take_item_out_of_drawer">take item out of drawer</option>
                                        <option value="take_lid_off_saucepan">take lid off saucepan</option>
                                        <option value="take_money_out_safe">take money out safe</option>
                                        <option value="take_off_weighing_scales">take off weighing scales</option>
                                        <option value="take_plate_off_colored_dish_rack">take plate off rack</option>
                                        <option value="take_shoes_out_of_box">take shoes out of box</option>
                                        <option value="turn_oven_on">turn oven on</option>
                                        -->
                                    </select>
                                </div>
                                and failure mode
                                <div class="select is-small">
                                    <select id="simulation-menu-failure-mode" onchange="updateFailureModeVideo()">
                                        <option value="grasp" selected="selected">Grasp</option>
                                        <option value="slip">Slip</option>
                                        <option value="translation_x">Translation X</option>
                                        <option value="translation_y">Translation Y</option>
                                        <option value="translation_z">Translation Z</option>
                                        <option value="rotation_x">Rotation X</option>
                                        <option value="rotation_y">Rotation Y</option>
                                        <option value="rotation_z">Rotation Z</option>
                                        <option value="no_rotation">No Rotation</option>
                                        <option value="wrong_sequence">Wrong Sequence</option>
                                        <!--<option value="wrong_object">Wrong Object</option>-->
                                    </select>
                                </div>
                                <br>
                                <br>
                                <video id="simulation-menu-video" muted autoplay loop>
                                    <source src="static/videos/simulation/basketball_in_hoop/vid_basketball_in_hoop_grasp.mp4" type="video/mp4">
                                </video>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container is-max-widescreen">
            <div class="rows">
                <div class="rows is-centered ">
                    <div class="row is-full-width">
                        <h2 class="title is-3"><span class="dvima">RoboFail Rewards and Policies</span></h2>
                    </div>
                </div>
            </div>
            <br>
            <div class="columns" style="align-items: end;">
                <div class="column is-half">
                    <p style="font-size: 1.5em"><b>ManiSkill</b></p>
                    <div class="col-md-4 col-sm-4 col-xs-4">
                        <img src="static/videos/maniskill/task1.png" width="18%" style="border-radius: 5px;" alt='<b>Task 1</b>, best Aha improved reward:
                        [sep]
                        static/txt/reward_functions/maniskill/task1.txt' onclick="populateDemo(this, 1);">

                        <img src="static/videos/maniskill/task2.png" width="18%" style="border-radius: 5px;" alt='<b>Task 2</b>, best Aha improved reward:
                        [sep]
                        static/txt/reward_functions/maniskill/task2.txt' onclick="populateDemo(this, 1);">

                        <img src="static/videos/maniskill/task3.png" width="18%" style="border-radius: 5px;" alt='<b>Task 3</b>, best Aha improved reward:
                        [sep]
                        static/txt/reward_functions/maniskill/task3.txt' onclick="populateDemo(this, 1);">

                        <img src="static/videos/maniskill/task4.png" width="18%" style="border-radius: 5px;" alt='<b>Task 4</b>, best Aha improved reward:
                        [sep]
                        static/txt/reward_functions/maniskill/task4.txt' onclick="populateDemo(this, 1);">

                        <img src="static/videos/maniskill/task5.png" width="18%" style="border-radius: 5px;" alt='<b>Task 4</b>, best Aha improved reward:
                        [sep]
                        static/txt/reward_functions/maniskill/task5.txt' onclick="populateDemo(this, 1);">
                    </div>

                    <br>
                    <p style="font-size: 1.5em"><b>TAMP</b></p>
                    <div class="col-md-4 col-sm-4 col-xs-4">
                        <img src="static/videos/tamp/t1.png" width="18%" style="border-radius: 5px;" alt='<b>Task 1</b>, best Aha Improved Task-plan:
                        [sep]
                        static/txt/reward_functions/tamp/t1.txt' onclick="populateDemo(this, 1);">

                        <img src="static/videos/tamp/t2.png" width="18%" style="border-radius: 5px;" alt='<b>Task 2</b>, best Aha Improved Task-plan:
                        [sep]
                        static/txt/reward_functions/tamp/t2.txt' onclick="populateDemo(this, 1);">

                        <img src="static/videos/tamp/t3.png" width="18%" style="border-radius: 5px;" alt='<b>Task 3</b>, best Aha Improved Task-plan:
                        [sep]
                        static/txt/reward_functions/tamp/t3.txt' onclick="populateDemo(this, 1);">
                    </div>

                    <br>
                    <p style="font-size: 1.5em"><b>Manipulate Anything</b></p>
                    <div class="col-md-4 col-sm-4 col-xs-4">
                        <img src="static/videos/ma/pick_and_lift.png" width="18%" style="border-radius: 5px;" onclick="populateDemo(this, 1, false);">
                        <img src="static/videos/ma/pick_up_cup.png" width="18%" style="border-radius: 5px;" onclick="populateDemo(this, 1, false);">
                        <img src="static/videos/ma/put_block.png" width="18%" style="border-radius: 5px;" onclick="populateDemo(this, 1, false);">
                        <img src="static/videos/ma/sort_mustard.png" width="18%" style="border-radius: 5px;" onclick="populateDemo(this, 1, false);">
                    </div>
                </div>
                <div class="row border rounded" style="padding-top:12px; padding-bottom:12px;">
                    <div class="col-md-6">
                        <video id="demo-video-1" style="border-radius: 5px;" autoplay loop muted webkit-playsinline
                            playsinline onclick="setAttribute('controls', 'true');">
                            <source id="expandedImg-1" src="static/videos/placeholder.mp4" type="video/mp4">
                        </video>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div id="imgtext-1" style="font-size: 1.5em">Select an image above:</div>
                <div>
                    <pre
                        class="p-1"><code class="language-python" id="answer-1">Eureka response shown within code block.</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Datasets -->
    <section class="hero is-light is-small">
        <div class="hero-body">
            <div class="container">
                <h2 class="title is-3">Datasets</h2>
                <div class="column has-text-centered">
                    <h3 class="title is-5">Maniskill-failgen</h3>
                </div>
                <div id="results-carousel" class="carousel results-carousel">
                    <div class="item item-steve">
                        <video id="steve" autoplay muted loop>
                            <source src="static/videos/datasets/failgen_maniskill/fail_pick_cube_0.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-fullbody">
                        <video id="fullbody" autoplay muted loop>
                            <source src="static/videos/datasets/failgen_maniskill/fail_pick_cube_1.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-shiba">
                        <video id="shiba" autoplay muted loop>
                            <source src="static/videos/datasets/failgen_maniskill/fail_plug_charger_0.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-ender">
                        <video id="ender" autoplay muted loop>
                            <source src="static/videos/datasets/failgen_maniskill/fail_push_cube_0.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-pokemon">
                        <video id="pokemon" autoplay muted loop>
                            <source src="static/videos/datasets/failgen_maniskill/fail_push_cube_1.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-chansey">
                        <video id="chansey" autoplay muted loop>
                            <source src="static/videos/datasets/failgen_maniskill/fail_stack_cube_0.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-pikachu">
                        <video id="pikachu" autoplay muted loop>
                            <source src="static/videos/datasets/failgen_maniskill/fail_stack_cube_1.mp4" type="video/mp4">
                        </video>
                    </div>
                </div>
                <br>
                <br>
                <div class="column has-text-centered">
                    <h3 class="title is-5">Robofail-test</h3>
                </div>
                <div id="results-carousel" class="carousel results-carousel">
                    <div class="item item-patrick">
                        <video id="patrick" autoplay muted loop>
                            <source src="static/videos/datasets/robofail_test/vid_hockey_no_rotation.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-fullcuerpo">
                        <video id="fullcuerpo" autoplay muted loop>
                            <source src="static/videos/datasets/robofail_test/vid_lamp_off_rotation_x.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-shibar">
                        <video id="shibar" autoplay muted loop>
                            <source src="static/videos/datasets/robofail_test/vid_open_oven_translation_y.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-enderman">
                        <video id="enderman" autoplay muted loop>
                            <source src="static/videos/datasets/robofail_test/vid_place_hanger_on_rack_wrong_sequence.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-digimon">
                        <video id="digimon" autoplay muted loop>
                            <source src="static/videos/datasets/robofail_test/vid_stack_chairs_slip.mp4" type="video/mp4">
                        </video>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- /Datasets -->

    <!-- Real World -->
    <section class="hero is-light is-small">
        <div class="hero-body">
            <div class="container">
                <h2 class="title is-3">Real World results</h2>
                <div id="results-carousel" class="carousel results-carousel">
                    <div class="item item-steve">
                        <video id="steve" autoplay muted loop>
                            <source src="static/videos/real_world/real_world_0.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-fullbody">
                        <video id="fullbody" autoplay muted loop>
                            <source src="static/videos/real_world/real_world_1.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-shiba">
                        <video id="shiba" autoplay muted loop>
                            <source src="static/videos/real_world/real_world_2.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-ender">
                        <video id="ender" autoplay muted loop>
                            <source src="static/videos/real_world/real_world_3.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="item item-pokemon">
                        <video id="pokemon" autoplay muted loop>
                            <source src="static/videos/real_world/real_world_4.mp4" type="video/mp4">
                        </video>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- /Real World -->

</body>
</html>
